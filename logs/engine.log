DependencyConflict: requested: "psycopg2 >= 2.7.3.1" but found: "None"
INFO:     Started server process [132242]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
Warning: asyncpg not installed. Run: pip install asyncpg
[engine] DB clients disabled: No module named 'sqlalchemy'
[Tracing] OpenTelemetry enabled for Engine
INFO:     127.0.0.1:41266 - "GET /api/health HTTP/1.1" 200 OK
[server] Estimator validation: 3/7 estimators can run
[server]   ✓ tvce
[server]   ✓ ope
[server]   ✓ hidden
[server]   ✗ iv: z
[server]   ✗ transport: domain
[server]   ✗ proximal: w_neg, z_neg
[server]   ✗ network: cluster_id, neighbor_exposure
[server]   ✓ tvce: τ=2.0689 ± 1.1770 (0.00s)
[server]   ✓ ope: τ=2.0689 ± 1.1770 (0.00s)
[server]   ✓ hidden: τ=2.0689 ± 1.1770 (0.00s)
[server] Using matplotlib fallback (WolframONE disabled for debugging)
[server] Generated 11 figures with matplotlib
[primitive] Starting generation in /home/hirokionodera/cqox-complete_b/reports/figures/job_8e28a395
[primitive] y=test_score_raw, t=age_group, time=missing_days
[primitive] covariates: ['name', 'received_tutoring', 'gender_code', 'household_income_range', 'parent_education']
[primitive] Attempting timeseries...
[primitive] ✅ timeseries: /home/hirokionodera/cqox-complete_b/reports/figures/job_8e28a395/primitive_timeseries.png
[primitive] Attempting distribution...
[primitive] ✅ distribution: /home/hirokionodera/cqox-complete_b/reports/figures/job_8e28a395/primitive_distribution.png
[primitive] Attempting scatter...
[primitive] Attempting heterogeneity...
[primitive] Attempting propensity...
[primitive] Attempting balance...
[primitive] Completed. Generated 2 figures: ['primitive_timeseries', 'primitive_distribution']
[DomainFigures] Generating 4/5 figures for education
[DomainFigures] Recommended: education_gain_distrib, education_attainment_sankey, education_event_study, education_fairness...
[server] Generated 2 advanced figures (41-42)
INFO:     127.0.0.1:40184 - "POST /api/analyze/comprehensive HTTP/1.1" 200 OK
INFO:     127.0.0.1:53112 - "POST /api/analyze/comprehensive HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3790, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_segment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/opentelemetry/instrumentation/asgi/__init__.py", line 606, in __call__
    await self.app(scope, otel_receive, otel_send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/observability/metrics.py", line 262, in observability_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/engine/server.py", line 148, in analyze
    if df[t].dtype == 'object' or df[t].nunique() > 2:
       ~~^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3797, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_segment'
INFO:     127.0.0.1:53128 - "POST /api/analyze/comprehensive HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3790, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_segment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/opentelemetry/instrumentation/asgi/__init__.py", line 606, in __call__
    await self.app(scope, otel_receive, otel_send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/observability/metrics.py", line 262, in observability_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/engine/server.py", line 148, in analyze
    if df[t].dtype == 'object' or df[t].nunique() > 2:
       ~~^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3797, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_segment'
INFO:     127.0.0.1:53132 - "POST /api/analyze/comprehensive HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3790, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_segment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/opentelemetry/instrumentation/asgi/__init__.py", line 606, in __call__
    await self.app(scope, otel_receive, otel_send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/observability/metrics.py", line 262, in observability_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/engine/server.py", line 148, in analyze
    if df[t].dtype == 'object' or df[t].nunique() > 2:
       ~~^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3797, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_segment'
INFO:     127.0.0.1:53138 - "POST /api/analyze/comprehensive HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3790, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_segment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/opentelemetry/instrumentation/asgi/__init__.py", line 606, in __call__
    await self.app(scope, otel_receive, otel_send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/observability/metrics.py", line 262, in observability_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/engine/server.py", line 148, in analyze
    if df[t].dtype == 'object' or df[t].nunique() > 2:
       ~~^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3797, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_segment'
INFO:     127.0.0.1:58732 - "POST /api/analyze/comprehensive HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3790, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_segment'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/opentelemetry/instrumentation/asgi/__init__.py", line 606, in __call__
    await self.app(scope, otel_receive, otel_send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/observability/metrics.py", line 262, in observability_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/backend/engine/server.py", line 148, in analyze
    if df[t].dtype == 'object' or df[t].nunique() > 2:
       ~~^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/hirokionodera/cqox-complete_b/.venv/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 3797, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_segment'
[server] Estimator validation: 3/7 estimators can run
[server]   ✓ tvce
[server]   ✓ ope
[server]   ✓ hidden
[server]   ✗ iv: z
[server]   ✗ transport: domain
[server]   ✗ proximal: w_neg, z_neg
[server]   ✗ network: cluster_id, neighbor_exposure
[server]   ✓ tvce: τ=2.0689 ± 1.1770 (0.00s)
[server]   ✓ ope: τ=2.0689 ± 1.1770 (0.00s)
[server]   ✓ hidden: τ=2.0689 ± 1.1770 (0.00s)
[server] Using matplotlib fallback (WolframONE disabled for debugging)
[server] Generated 11 figures with matplotlib
[primitive] Starting generation in /home/hirokionodera/cqox-complete_b/reports/figures/job_e75af9a3
[primitive] y=test_score_raw, t=age_group, time=missing_days
[primitive] covariates: ['name', 'received_tutoring', 'gender_code', 'household_income_range', 'parent_education']
[primitive] Attempting timeseries...
[primitive] ✅ timeseries: /home/hirokionodera/cqox-complete_b/reports/figures/job_e75af9a3/primitive_timeseries.png
[primitive] Attempting distribution...
[primitive] ✅ distribution: /home/hirokionodera/cqox-complete_b/reports/figures/job_e75af9a3/primitive_distribution.png
[primitive] Attempting scatter...
[primitive] Attempting heterogeneity...
[primitive] Attempting propensity...
[primitive] Attempting balance...
[primitive] Completed. Generated 2 figures: ['primitive_timeseries', 'primitive_distribution']
[DomainFigures] Generating 4/5 figures for education
[DomainFigures] Recommended: education_gain_distrib, education_attainment_sankey, education_event_study, education_fairness...
[server] Generated 2 advanced figures (41-42)
INFO:     127.0.0.1:43918 - "POST /api/analyze/comprehensive HTTP/1.1" 200 OK
